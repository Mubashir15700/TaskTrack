import{$ as _,a0 as x,a1 as F,e as R,o as L,u as H,r as t,j as s,a2 as O,a3 as u,A as V,_ as i,a4 as j,a5 as G,a6 as J}from"./index-4386c688.js";import{I as M}from"./imageUrls-ebc684b3.js";const q=_().shape({username:x().trim().nullable().min(3,"Username must be at least 3 characters"),phone:x().trim().nullable().matches(/^\d{10}$/,"Phone number must be 10 digits"),email:x().trim().nullable().email("Invalid email address"),profile:F().test("isImageOrEmpty","Invalid file format",n=>n?["image/jpeg","image/png","image/gif"].includes(n.type):!0)}),K=()=>{const n=R(),d=L(),e=H(a=>a.user.userData),[r,v]=t.useState({username:e==null?void 0:e.username,profile:e==null?void 0:e.profile,phone:e==null?void 0:e.phone,email:e==null?void 0:e.email}),[b,c]=t.useState(!1),[m,y]=t.useState(!1),[f,S]=t.useState(""),[p,N]=t.useState({}),[h,E]=t.useState(""),g=a=>{e!==r&&c(!0);const{name:l,value:o}=a.target;v({...r,[l]:o})},I=a=>{v({...r,profile:a}),c(!0),y(!0)},w=a=>{S(a),c(!0)},A=async a=>{i.success("Deleted location successfully"),d(j(a))},C=async()=>{try{const a={username:r.username,email:r.email,phone:r.phone};m&&(a.profile=r.profile),await q.validate(a,{abortEarly:!1}),N({});const l=new FormData;if(l.append("username",r.username),l.append("email",r.email),l.append("phone",r.phone),f&&typeof f=="object"){const k=JSON.stringify(f);l.append("location",k)}r.profile instanceof File&&m&&l.append("profile",r.profile);const o=await G(l,e==null?void 0:e._id);o&&(o==null?void 0:o.status)===200?(d(j(o.updatedUser)),n("/account"),i.success("Updated profile successfully"),c(!1)):(console.error("Error updating profile:",o),i.error((o==null?void 0:o.message)||"An error occurred during profile update"))}catch(a){if(console.error("Error updating profile:",a),a.name==="ValidationError"){const l={};a.inner.forEach(o=>{l[o.path]=o.message}),N(l)}else E({status:"failed",message:"An error occurred during profile update"})}},P=async()=>{try{const a=await J(e==null?void 0:e._id,e.profile);if(a&&a.status===200){const l=a.updatedUser;d(j(l)),n("/profile"),i.success("Deleted profile image successfully")}else i.error("An unexpected error occurred during profile image update")}catch(a){console.error("Error deleting profile image:",a),i.error("An unexpected error occurred during profile image update")}},$=`https://tasktrack.online/uploads/profile/${e==null?void 0:e.profile}`,D={userId:e==null?void 0:e._id,label:"Lives In",currentAddress:(e==null?void 0:e.location)||{},onAddressChange:w,onLocationDeleted:A,usage:"profile"};return s.jsx("div",{className:"col-10 my-3 mx-auto",children:e?s.jsxs("div",{className:"p-3 p-lg-5 border",children:[s.jsxs("div",{className:"d-flex align-items-end",children:[e.profile&&!m&&s.jsx("img",{src:$,alt:"Profile",style:{maxHeight:"130px",width:"150px"},className:"rounded-3 img-fluid"}),e.profile&&s.jsx("i",{className:"bi bi-trash",style:{cursor:"pointer"},onClick:P}),!e.profile&&!m&&s.jsx("img",{src:M.avatar,alt:"Profile",style:{maxHeight:"130px",width:"150px"},className:"rounded-circle img-fluid"})]}),s.jsx("div",{className:"mb-2",children:s.jsx(O,{onNewImageUrl:I,purpose:"profile"})}),s.jsx(u,{error:p.profile}),s.jsxs("div",{children:[s.jsxs("div",{className:"form-group row",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx("label",{children:"Username"}),s.jsx("input",{type:"text",className:"form-control",name:"username",value:r==null?void 0:r.username,onChange:g}),s.jsx(u,{error:p.username})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx("label",{children:"Phone"}),s.jsx("input",{type:"number",className:"form-control",name:"phone",value:r==null?void 0:r.phone,onChange:g}),s.jsx(u,{error:p.phone})]})]}),s.jsx("div",{className:"form-group row",children:s.jsxs("div",{className:"col-md-12",children:[s.jsx("label",{children:"Email"}),s.jsx("input",{type:"email",className:"form-control",name:"email",value:r==null?void 0:r.email,onChange:g}),s.jsx(u,{error:p.email})]})}),s.jsx("div",{children:s.jsx(V,{...D})}),b&&s.jsx("div",{className:"form-group row mt-3",children:s.jsx("div",{className:"col-lg-12",children:s.jsx("button",{type:"button",className:"btn btn-primary btn-block",onClick:C,children:"Update Profile"})})}),h&&s.jsx("div",{className:`alert ${h.status==="failed"?"alert-danger":"alert-success"} mt-3`,role:"alert",children:h.message})]})]}):s.jsx("div",{className:"mt-5 mx-auto",children:s.jsx("p",{children:"No data found"})})})};export{K as default};

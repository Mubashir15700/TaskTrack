import{r as b,u as f,a as S,j as e,ab as k,ac as l,ad as c,F as p,X as u,A as E,ae as o,af as C,t as y,ag as J,S as P,ah as _,_ as n,s as g,ai as q}from"./index-9d72eabb.js";import{P as v}from"./ProfileCard-d957dd72.js";import"./imageUrls-ebc684b3.js";function H(){var m,j;const[r,I]=b.useState({}),d=f(s=>{var a,t;return(t=(a=s.user)==null?void 0:a.userData)==null?void 0:t._id}),w=f(s=>{var a,t;return(t=(a=s.user)==null?void 0:a.userData)==null?void 0:t.isJobSeeker}),{id:i}=S(),h=async()=>{try{const s=await J(i);s&&s.status===200&&I(s.job)}catch(s){console.log(s)}};b.useEffect(()=>{h()},[i]);const x=async(s,a,t)=>{(await P.confirmAction(s,a,"Confirm","#d9534f")).isConfirmed&&(s==="Express Interest"?A(t):N(t))},A=async s=>{if(w)try{const a=await _({jobId:i,field:s,laborerId:d});a&&a.status?(n.success("Successfully applied for this job"),h(),g.emit("new_applicant",{empId:r.userId,jobId:i})):n.error("Failed to apply for this job")}catch(a){console.log("Error while applying job:",a),n.error("An error occurred while applying for this job")}else n.error("You are not a laborer")},N=async s=>{try{const a=await q({jobId:i,field:s,laborerId:d});a&&a.status?(n.success("Successfully cancelled application for this job"),h(),g.emit("application_cancel",{empId:r.userId,jobId:i})):n.error("Failed to cancel application for this job")}catch(a){console.log("Error while cancelling job applicaton:",a),n.error("An error occurred while cancelling application for this job")}},D=(s,a)=>s.applicants.some(t=>t.userId===a);return e.jsx("section",{style:{backgroundColor:"#eee"},children:e.jsx(k,{className:"py-5",children:r?e.jsxs(l,{children:[e.jsxs(c,{lg:"4",children:[e.jsx(v,{imageSrc:(m=r.userDetails)==null?void 0:m.profile,title:"Posted By",userId:r==null?void 0:r.userId,username:(j=r==null?void 0:r.userDetails)==null?void 0:j.username}),e.jsx(p,{className:"mb-4 mb-lg-0",children:e.jsx(u,{className:"p-2",children:e.jsx(E,{label:"Location",currentAddress:r==null?void 0:r.location,usage:"display-laborer"})})})]}),e.jsxs(c,{lg:"8",children:[e.jsx(p,{className:"mb-4",children:e.jsxs(u,{children:[e.jsx(l,{children:e.jsxs(c,{className:"d-flex justify-content-between",children:[e.jsx(o,{children:r.title}),e.jsxs(o,{children:["Posted on: ",new Date(r.postedAt).toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"})]})]})}),e.jsx(l,{children:e.jsx(c,{children:e.jsx(o,{className:"text-muted",children:r.description})})}),e.jsx("hr",{}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"text-muted",children:["Deadline: ",new Date(r.date).toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"}),", ",r.time]}),e.jsxs(o,{className:"text-muted",children:["Duration: ",r.duration,"(hrs)"]})]}),e.jsx(c,{children:e.jsxs(o,{className:"text-muted",children:["Status: ",r.status]})})]})]})}),e.jsx(l,{children:e.jsx(c,{children:e.jsx(p,{className:"mb-4 mb-md-0",children:e.jsxs(u,{children:[e.jsx(o,{className:"mb-4",children:"Required Workers"}),r.fields&&r.fields.map((s,a)=>e.jsxs(u,{children:[e.jsx(C,{children:s.name}),e.jsxs(o,{children:["Workers Needed: ",s.workers]}),e.jsxs(o,{children:["Materials Required: ",s.materialsRequired]}),e.jsxs(o,{children:["Wage Per Hour: ",s.wagePerHour]}),d&&r.status!=="closed"&&(D(s,d)?e.jsx(y,{className:"bg-danger",onClick:()=>x("Cancel Application","Are you sure you want to cancel this application?",s.name),children:"Cancel Application"}):e.jsx(y,{onClick:()=>x("Express Interest","Are you sure you want to express interest in this field?",s.name),children:"Express Interest"})),e.jsx("hr",{})]},a))]})})})})]})]}):e.jsx("div",{children:"No job found"})})})}export{H as default};

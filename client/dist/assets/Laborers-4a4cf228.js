import{r as d,u as h,j as e,L as E,_ as x}from"./index-9d72eabb.js";import{I as R}from"./index.es-72e89bd5.js";import{N as A}from"./NearMeButton-5c77cf25.js";import{a as J}from"./laborer-52efcbe7.js";import{I as O}from"./imageUrls-ebc684b3.js";const B=()=>{const[c,u]=d.useState([]),[f,I]=d.useState(1),[M,g]=d.useState(0),m=h(s=>{var t;return(t=s.user)==null?void 0:t.searchResults}),j=h(s=>{var t;return(t=s.user.userData)==null?void 0:t._id});let i;j&&(i=h(s=>{var t,a;return(a=(t=s.user)==null?void 0:t.userData)==null?void 0:a.location}),i&&typeof i=="string"&&(i=JSON.parse(i)));const{lat:N,lon:L}=i||{},v=s=>{var t,a;return{...s,user:{...s.user,location:typeof((t=s.user)==null?void 0:t.location)=="string"?JSON.parse(s.user.location??"null"):(a=s.user)==null?void 0:a.location}}},p=async(s,t,a)=>{var r;try{const n=await J(j,s,t,a);if(n&&n.status===200){const l=(r=n.laborers)==null?void 0:r.map(v);u(o=>[...o,...l]),I(o=>o+1),g(n.totalPages)}else x.error("Failed to fetch laborers")}catch(n){x.error("An error occured while fetching laborers"),console.log(n)}};d.useEffect(()=>{if(m.searchOn==="laborers"){const s=m.results.map(v);u(s)}else p(f)},[m]);const P=()=>{N&&L?(u([]),g(0),p(1,N,L)):(x.error("Latitude and longitude are not available."),console.log("Latitude and longitude are not available."))};return e.jsxs("div",{className:"col-10 mx-auto my-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h3",{className:"mb-0",children:"Laborers"}),e.jsx(A,{text:"Find laborers near me",purpose:"laborers",onClickNearMe:P})]}),c!=null&&c.length?e.jsx(R,{dataLength:c.length,hasMore:f<=M,loader:e.jsx("div",{children:"Hang on, loading content..."}),next:()=>p(),children:e.jsx("div",{className:"row",children:c.map((s,t)=>{var a,r,n,l,o,S,y,k,w;return e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(E,{to:`/laborers/${(a=s==null?void 0:s.user)==null?void 0:a._id}`,className:"text-decoration-none",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("img",{src:(r=s.user)!=null&&r.profile?`https://tasktrack.online/uploads/profile/${(n=s.user)==null?void 0:n.profile}`:O.avatar,alt:"Profile",style:{width:"150px"},className:"rounded-circle mb-2 mx-auto img-fluid"}),e.jsx("h6",{className:"card-subtitle text-muted mb-2",children:(l=s==null?void 0:s.user)==null?void 0:l.username}),e.jsxs("p",{children:["Job Skills: ",(o=s==null?void 0:s.fields)==null?void 0:o.map(_=>_.name).join(", ")]}),e.jsxs("p",{children:[(y=(S=s==null?void 0:s.user)==null?void 0:S.location)==null?void 0:y.district,", ",(w=(k=s==null?void 0:s.user)==null?void 0:k.location)==null?void 0:w.state]})]})})})},t)})})}):e.jsx("div",{children:"No data found"})]})};export{B as default};

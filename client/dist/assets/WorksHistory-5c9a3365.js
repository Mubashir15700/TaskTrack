import{e as A,u as f,r,j as s,L as i,P as D,Q as N,S as L,T as I,_ as o}from"./index-4386c688.js";import{I as H}from"./index.es-7fb2a029.js";import{g as T}from"./laborer-6884a742.js";import{J as W}from"./Job-466a828e.js";import"./imageUrls-ebc684b3.js";const G=()=>{const u=A(),n=f(e=>e.user.userData._id),b=f(e=>e.user.userData.isJobSeeker),[c,h]=r.useState([]),[d,p]=r.useState(1),[y,x]=r.useState(0),[a,j]=r.useState({}),[m,v]=r.useState(null),g=async()=>{try{const e=await D(n,d);e&&e.status===200&&(h(e.works),p(t=>t+1),x(e.totalPages))}catch(e){console.log(e)}},q=async()=>{try{const e=await N(n);if(e&&e.status===200){const t=e.request;if(t){const l={userId:t.userId,languages:t.languages,education:t.education,avlDays:t.avlDays,avlTimes:t.avlTimes,fields:t.fields,status:t.status};j(l),e.reason&&v(e.reason)}}}catch(e){console.log(e)}};r.useEffect(()=>{g(),q()},[]);const R=async()=>{(await L.confirmAction("Cancel Request","Are you sure you want to cancel this request?","Cancel","#d9534f")).isConfirmed&&P()},P=async()=>{try{const e=await I({currentUserId:n});e?e.status===200?(o.success("Cancelled request successfully"),u("/account")):o.error(e==null?void 0:e.message):o.error("Failed to cancel request. Please try again.")}catch(e){console.error("Error cancelling request:",e),o.error("An error occurred while cancelling the request. Please try again.")}},S=async()=>{try{const e=await T(n);if(e&&e.status===200){const{languages:t,education:l,avlDays:k,avlTimes:w,fields:C}=e.laborer;u("/laborer-profile",{state:{laborerProfileData:{userId:n,languages:t??"",education:l??"",avlDays:k,avlTimes:w,fields:C}}})}else o.error(e.message)}catch(e){o.error("An error occurerd while fetching data"),console.log("Get laborer profile error: ",e)}};return s.jsxs("div",{className:"col-10 mx-auto my-3",children:[s.jsx("h3",{className:"mb-4",children:"Your Work History"}),c.length?s.jsx(H,{dataLength:c.length,hasMore:d<=y,loader:s.jsx("div",{children:"Hang on, loading content..."}),next:()=>g(),children:c.map((e,t)=>s.jsx("div",{className:"card mb-3",children:s.jsx(W,{isListed:!1,title:e.title,description:e.description,village:e.location.village,district:e.location.district,postedAt:e.postedAt,status:e.status,id:e._id})},t))}):s.jsxs("div",{className:"d-flex justify-content-center align-items-center flex-column",children:[s.jsx("p",{children:"You haven't done any works yet"}),Object.values(a).length>0?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:a.status==="pending"?"Your request to become laborer has been sent to admin.":`Your request to become laborer has been ${a.status}`}),m&&s.jsxs("p",{children:["Reason: ",m]}),s.jsxs("div",{className:"d-md-flex justify-content-between col-6",children:[a.status!=="approved"?s.jsx(i,{to:"/become-laborer-form",...a&&{state:a},className:"btn btn-primary col-12 col-md-5 mb-2",children:"View Request"}):s.jsx(i,{onClick:()=>S(),className:"btn btn-primary col-12 col-md-5 mb-2",children:"Manage Laborer Profile"}),s.jsx("button",{className:"btn btn-danger col-12 col-md-5 mb-2",onClick:R,disabled:a.status!=="pending",children:"Cancel"})]})]}):!b&&s.jsx(i,{to:"/become-laborer-form",children:"You wanna become a laborer?"})]})]})};export{G as default};

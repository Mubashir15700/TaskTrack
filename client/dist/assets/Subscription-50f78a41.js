import{r as m,u as T,j as r,Z as D}from"./index-4386c688.js";import{g as F,a as M,b as k,c as J}from"./plan-4628fea7.js";var x={};Object.defineProperty(x,"__esModule",{value:!0});function v(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?v=function(t){return typeof t}:v=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(e)}var P="https://js.stripe.com/v3",U=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,I="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",W=function(){for(var t=document.querySelectorAll('script[src^="'.concat(P,'"]')),n=0;n<t.length;n++){var i=t[n];if(U.test(i.src))return i}return null},_=function(t){var n=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat(P).concat(n);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(i),i},q=function(t,n){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:n})},p=null,f=null,h=null,G=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},K=function(t,n){return function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}},$=function(t){return p!==null?p:(p=new Promise(function(n,i){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&t&&console.warn(I),window.Stripe){n(window.Stripe);return}try{var s=W();if(s&&t)console.warn(I);else if(!s)s=_(t);else if(s&&h!==null&&f!==null){var c;s.removeEventListener("load",h),s.removeEventListener("error",f),(c=s.parentNode)===null||c===void 0||c.removeChild(s),s=_(t)}h=K(n,i),f=G(i),s.addEventListener("load",h),s.addEventListener("error",f)}catch(d){i(d);return}}),p.catch(function(n){return p=null,Promise.reject(n)}))},X=function(t,n,i){if(t===null)return null;var s=t.apply(void 0,n);return q(s,i),s},A=function(t){var n=`invalid load parameters; expected object of shape

    {advancedFraudSignals: boolean}

but received

    `.concat(JSON.stringify(t),`
`);if(t===null||v(t)!=="object")throw new Error(n);if(Object.keys(t).length===1&&typeof t.advancedFraudSignals=="boolean")return t;throw new Error(n)},b,j=!1,C=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];j=!0;var s=Date.now();return $(b).then(function(c){return X(c,n,s)})};C.setLoadParameters=function(e){if(j&&b){var t=A(e),n=Object.keys(t),i=n.reduce(function(s,c){var d;return s&&e[c]===((d=b)===null||d===void 0?void 0:d[c])},!0);if(i)return}if(j)throw new Error("You cannot change load parameters after calling loadStripe");b=A(e)};x.loadStripe=C;var B=x;const z=()=>{var g,w,N,E,L;const[e,t]=m.useState({}),[n,i]=m.useState([]),[s,c]=m.useState(null),d=T(a=>a.user.userData),{_id:O,email:R,currentSubscription:S}=d||{};m.useEffect(()=>{const a=async()=>{try{const o=await F();o&&o.status===200&&i(o.plans)}catch(o){console.log(o)}},l=async()=>{try{const o=await M(S);o&&o.status===200&&t(o.currentPlan)}catch(o){console.error(o)}};a(),S&&l()},[]);const y=async a=>{c(a._id);try{const l=await k(),o=await B.loadStripe(l.stripePublicKey),u=await J({item:a,user:{userId:O,email:R}});if(!u.id)throw new Error("Invalid response from the server");if(localStorage.setItem("sessionId",u.id),u.status!==200)throw new Error(`Server error: ${u.status} - ${u.statusText}`);await o.redirectToCheckout({sessionId:u.id})}catch(l){if(l.status===409&&l.redirectUrl){window.location.href=l.redirectUrl;return}else console.error(l),D.error("An error occured")}finally{c(null)}};return r.jsxs("div",{className:"col-10 my-3 mx-auto",children:[r.jsx("h3",{className:"mb-4",children:"Subscription Management"}),Object.keys(e).length?r.jsxs(r.Fragment,{children:[r.jsx("h6",{children:"Active Plans"}),r.jsxs("div",{className:"card mb-3",children:[r.jsx("div",{className:"card-header",children:(g=e==null?void 0:e.planId)==null?void 0:g.name}),r.jsxs("div",{className:"card-body d-flex flex-wrap justify-content-between",children:[r.jsxs("div",{className:"col-md-3 col-12 mb-3",children:[r.jsxs("p",{children:["Created at: ",e!=null&&e.createdAt?new Date(e.createdAt).toLocaleDateString():""]}),r.jsxs("p",{children:["Type: ",(w=e==null?void 0:e.planId)==null?void 0:w.type]})]}),r.jsxs("div",{className:"col-md-6 col-12 mb-3",children:[r.jsx("p",{className:"card-text"}),r.jsx("p",{className:"mb-1",children:(N=e==null?void 0:e.planId)==null?void 0:N.description}),r.jsxs("p",{className:"mb-1",children:["Total job posts: ",(E=e==null?void 0:e.planId)==null?void 0:E.numberOfJobPosts]}),r.jsxs("p",{className:"mb-1",children:["Remainig job posts: ",((L=e==null?void 0:e.planId)==null?void 0:L.numberOfJobPosts)-(e==null?void 0:e.jobPostsCount)]})]}),r.jsxs("div",{className:"col-md-3 col-12 mb-3",children:[r.jsxs("p",{children:["Status: ",e!=null&&e.isActive?"Active":"Inactive"]}),r.jsxs("button",{className:"btn btn-secondary my-3",disabled:s===e._id,onClick:()=>y(e),children:[s===e._id&&r.jsx("span",{className:"spinner-border spinner-border-sm me-1","aria-hidden":"true"}),s===e._id?"Opening Stripe...":"Manage"]})]})]})]})]}):r.jsx("div",{children:"No active subscription found"}),r.jsx("section",{id:"price-section",children:r.jsx("div",{className:"container",children:r.jsxs("div",{className:"row d-flex justify-content-center pt-5",children:[r.jsx("div",{className:"row justify-content-center gapsectionsecond my-2",children:r.jsx("div",{className:"col-lg-7 text-center",children:r.jsx("h5",{children:"Available Subscription Plans"})})}),n!=null&&n.length?n.map((a,l)=>{var o;return r.jsx("div",{className:"card col-8 col-lg-3 py-5 pb-lg-0 m-2",children:r.jsx("div",{className:"wrap-price",children:r.jsxs("div",{className:"price-innerdetail text-center",children:[r.jsx("h5",{children:a.name}),r.jsxs("p",{className:"prices",children:["â‚¹",a.amount]}),r.jsx("div",{className:"detail-pricing",children:r.jsx("span",{className:"float-left",children:a.description})}),r.jsx("div",{className:"detail-pricing",children:r.jsxs("span",{className:"float-left",children:[" ",r.jsx("i",{className:"bi bi-check2-circle"})," ",`Can Post ${a.numberOfJobPosts} Jobs`]})}),r.jsxs("div",{className:"detail-pricing",children:[r.jsxs("span",{className:"float-left",children:[" ",r.jsx("i",{className:"bi bi-check2-circle"})," ","Consultation"]}),r.jsx("span",{className:"float-right",children:"Style"})]}),r.jsxs("button",{className:"btn btn-outline-primary my-3",disabled:s===a._id,onClick:()=>y(a),children:[s===a._id&&r.jsx("span",{className:"spinner-border spinner-border-sm me-1","aria-hidden":"true"}),s===a._id?"Opening Stripe...":((o=e==null?void 0:e.planId)==null?void 0:o._id)===a._id?"Manage":"Choose Plan"]})]})})},l)}):r.jsx("div",{children:"No available plans found"})]})})})]})};export{z as default};
